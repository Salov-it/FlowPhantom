–ß—Ç–æ –∑–Ω–∞—á–∏—Ç ¬´—Å–ª–∞—Ç—å VPN —Ç—Ä–∞—Ñ–∏–∫ –∫–∞–∫ VK –≤–∏–¥–µ–æ¬ª

–ö–æ–≥–¥–∞ —Ç—ã —Å–º–æ—Ç—Ä–∏—à—å –≤–∏–¥–µ–æ –≤ VK:

–¢—Ä–∞—Ñ–∏–∫ –∏–¥—ë—Ç –ø–æ HTTPS (TLS 1.3) –Ω–∞ –¥–æ–º–µ–Ω—ã —Ç–∏–ø–∞:

vkuseraudio.net

vkvideo.ru

userapi.com
(–∑–∞–≤–∏—Å–∏—Ç –æ—Ç CDN)

–ó–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –≤ –≤–∏–¥–µ:

GET /video_url?...range=XXXX-YYYY

–ù–µ—Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —á–∞–Ω–∫–∏: 256 KB ‚Üí –ø–∞—É–∑–∞ ‚Üí 1 MB ‚Üí –ø–∞—É–∑–∞ ‚Üí 512 KB ‚Üí –ø–∞—É–∑–∞

–ù–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤ (HLS/DASH)

–†–∞–∑–º–µ—Ä—ã –ø–∞–∫–µ—Ç–æ–≤ –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–µ, —Å–∏–ª—å–Ω–æ –ø–æ—Ö–æ–∂–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Å—Ç—Ä–∏–º–∏–Ω–≥.

üéØ –¢–≤–æ—è —Ü–µ–ª—å:

VPN –¥–æ–ª–∂–µ–Ω –≤—Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ–π —Ç—Ä–∞—Ñ–∏–∫ –≤–Ω—É—Ç—Ä—å —Ç–∞–∫–∏—Ö ¬´–ø–æ—Ö–æ–∂–∏—Ö¬ª —Å–µ–≥–º–µ–Ω—Ç–æ–≤, —á—Ç–æ–±—ã –¥–∞–∂–µ DPI –¥—É–º–∞–ª, —á—Ç–æ —ç—Ç–æ –æ–±—ã—á–Ω—ã–π –≤–∏–¥–µ–æ CDN.

üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã (FlowPhantom.VkVideoMask)
1) ClientWrapper.exe

–ó–∞–¥–∞—á–∞:
–ü—Ä–∏–Ω–∏–º–∞—Ç—å –æ–±—ã—á–Ω—ã–π VPN-—Ç—Ä–∞—Ñ–∏–∫ (SOCKS5/TUN), —Ä–∞–∑–±–∏–≤–∞—Ç—å –Ω–∞ ¬´–≤–∏–¥–µ–æ-—á–∞–Ω–∫–∏¬ª.

–§—É–Ω–∫—Ü–∏–∏:

–ß–∏—Ç–∞–µ—Ç —Å—ã—Ä–æ–π VPN –ø–æ—Ç–æ–∫

–†–µ–∂–µ—Ç –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã: 200‚Äì1200 KB, —Ä–∞–Ω–¥–æ–º

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç ¬´–ø–∞—É–∑—ã¬ª 30‚Äì300 ms

–ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏

–ü–æ–¥–º–µ—à–∏–≤–∞–µ—Ç —à—É–º (–ø—É—Å—Ç—ã–µ —á–∞–Ω–∫–∏ –∫–∞–∫ padding)

2) VkVideoProtoAdapter

–ó–∞–¥–∞—á–∞:
–û–±–æ—Ä–∞—á–∏–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —á–∞–Ω–∫ –≤ –∫–æ–ø–∏—é —Ä–µ–∞–ª—å–Ω–æ–≥–æ GET/HTTPS –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –∫–∞–∫ —É VK video CDN.

–¢–æ –µ—Å—Ç—å:

GET /video/c12345/seg-14-v1.mp4?extra=...&range=1048576-2097151 HTTP/1.1
Host: vkvideo.ru
User-Agent: VKClient/6.0 Android
Accept: */*


–ö–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –∑–∞–≥—Ä—É–∑–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–∞ –≤–∏–¥–µ–æ.

3) TLS/QUIC Mimic Layer

–¶–µ–ª—å ‚Äî —Ç—Ä–∞—Ñ–∏–∫ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ TLS 1.3/QUIC –æ—Ç VK.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è TLS 1.3 JA3 fingerprint –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π VK

–¢–µ–∫—Å—Ç—ã ClientHello/ServerHello –∫–æ–ø–∏—Ä—É—é—Ç—Å—è

HTTP/3 (QUIC) –ø–∞–∫–µ—Ç—ã —Å—Ç–∏–ª–∏–∑—É—é—Ç—Å—è –ø–æ–¥ –≤–∏–¥–µ–æ

4) Server Receiver (FlowPhantom.Gateway)

–ù–∞ —Ä–µ–∞–ª—å–Ω–æ–º VPN-—Å–µ—Ä–≤–µ—Ä–µ —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞:

—Å–ª—É—à–∞–µ—Ç HTTPS –∫–∞–∫ –±—É–¥—Ç–æ —ç—Ç–æ CDN

–≤—ã–Ω–∏–º–∞–µ—Ç –ø–æ–ª–µ–∑–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É (—Ç–≤–æ–∏ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∞–Ω–∫–∏)

—Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π VPN –ø–æ—Ç–æ–∫

–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ WireGuard/Xray backend

5) –û–±—â–∏–π pipeline
VPN App ‚Üí —Ç–≤–æ—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí —Ä–µ–∂–µ—Ç ‚Üí —à–∏—Ñ—Ä—É–µ—Ç ‚Üí –º–∞—Å–∫–∏—Ä—É–µ—Ç –ø–æ–¥ –í–ö ‚Üí 
HTTPS/QUIC ‚Üí —Å–µ—Ä–≤–µ—Ä ‚Üí –¥–µ–º–∞—Å–∫–∏—Ä—É–µ—Ç ‚Üí —Ä–µ–∞–ª—å–Ω—ã–π VPN –∫–∞–Ω–∞–ª

üß™ –ü–æ—á–µ–º—É DPI –Ω–µ —Å–º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∏—Ç—å

–í —Ü–µ–ª–æ–º –≤–µ—Å—å –ø–∞—Ç—Ç–µ—Ä–Ω = –∫–∞–∫ —É VK
–ù–µ—Ä–æ–≤–Ω—ã–µ –ø–∞—É–∑—ã ‚Üí –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —á–∞–Ω–∫–æ–≤ ‚Üí –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ ‚Üí –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–æ–º–µ–Ω—ã.

–ß–∞—Å—Ç–æ—Ç–∞ –∏ —ç–Ω—Ç—Ä–æ–ø–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
–í–∏–¥–µ–æ ‚Äî –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö ¬´—Ö–∞–æ—Ç–∏—á–Ω—ã—Ö¬ª —Ç–∏–ø–æ–≤ HTTPS.

–î–æ–º–µ–Ω VK –≤ whitelist —É –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ (–æ—Å–æ–±–µ–Ω–Ω–æ —Å–æ—Ç–æ–≤—ã—Ö)
DPI –Ω–µ –º–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å VK CDN ‚Äî –∏–Ω–∞—á–µ –≤–∏–¥–µ–æ –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —É –º–∏–ª–ª–∏–æ–Ω–æ–≤ –ª—é–¥–µ–π.

üß± –ß—Ç–æ —Ç—ã —Ä–µ–∞–ª—å–Ω–æ –±—É–¥–µ—à—å –ø–∏—Å–∞—Ç—å
–ú–æ–¥—É–ª—å  –Ø–∑—ã–∫  –ó–∞–¥–∞—á–∞
ClientWrapper C# (.NET 8) TUN/TAP –æ–±—Ä–∞–±–æ—Ç–∫–∞, —á–∞–Ω–∫–∏, –∑–∞–¥–µ—Ä–∂–∫–∏
VkVideoProtoAdapter C#  –≥–µ–Ω–µ—Ä–∞—Ü–∏—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å—Ç–∏–ª–µ VK
TLS/QUIC Layer  Rust/Go (–∏–ª–∏ C++) —Ñ–∏–Ω–≥–µ—Ä–ø—Ä–∏–Ω—Ç—ã TLS, –∏–º–∏—Ç–∞—Ü–∏—è QUIC
ServerReceiver  C#  –ø—Ä–∏—ë–º, —Å–±–æ—Ä–∫–∞, –ø–µ—Ä–µ–¥–∞—á–∞ –≤ Xray/WG
Crypto/Noise  C#  –æ–±—Ñ—É—Å–∫–∞—Ü–∏—è –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –≤–Ω—É—Ç—Ä–∏ —á–∞–Ω–∫–æ–≤
‚è±Ô∏è –°–∫–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω–æ —É–π–¥—ë—Ç –≤—Ä–µ–º–µ–Ω–∏?

–ï—Å–ª–∏ –ø–∏—Å–∞—Ç—å –ø—Ä–æ—Ç–æ—Ç–∏–ø —Å–∞–º–æ–≥–æ –≤–∞–∂–Ω–æ–≥–æ:

üéØ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è (–±–µ–∑ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ QUIC) ‚Äî 7‚Äì10 –¥–Ω–µ–π

üéØ –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å QUIC-–ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ ‚Äî 2‚Äì4 –Ω–µ–¥–µ–ª–∏

üéØ –ü–æ—Å—Ç–ø—Ä–æ–¥–∞–∫—à–µ–Ω –∏ —Ç–µ—Å—Ç—ã –Ω–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞—Ö ‚Äî +2 –Ω–µ–¥–µ–ª–∏

‚ùì –•–æ—á–µ—à—å ‚Äî —è —Ç–µ–±–µ –ø—Ä—è–º —Å–æ–∑–¥–∞–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–∞—Ä–∫–∞—Å –ø—Ä–æ–µ–∫—Ç–∞?

–ù–∞–ø—Ä–∏–º–µ—Ä:

FlowPhantom/
 ‚îú‚îÄ‚îÄ FlowPhantom.Client/
 ‚îú‚îÄ‚îÄ FlowPhantom.VideoMask/
 ‚îú‚îÄ‚îÄ FlowPhantom.TLS/
 ‚îú‚îÄ‚îÄ FlowPhantom.Server/
 ‚îî‚îÄ‚îÄ FlowPhantom.Shared/